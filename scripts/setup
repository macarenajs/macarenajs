#!/usr/bin/env bash
set -eou pipefail
dir="$(dirname "$0")"

# building

printf "Start build ğŸš§\n\n"
docker-compose build

printf "\n\nâœ…   Finish build\n"
sleep 2
printf "\033c"


# dependencies

printf "Start install deps "yarn install" â˜•ï¸\n\n"

"$dir/yarn" install

printf "\n\nâœ…   Finish install yarn\n"
sleep 2
printf "\033c"


# running containers

printf "Get containers running ğŸƒ\n\n"

docker-compose up -d

printf "\n\nâœ…   Finish get containers running\n"
sleep 2
printf "\033c"


printf "Run database migrations ğŸ“ˆ\n\n"

# migrate data

"$dir/migrate"

printf "\n\nâœ…   Finish migration\n"
sleep 2
printf "\033c"

printf "\033c"
printf "===================\n"
echo "ğŸ’ª  It's all set ğŸ’¥"
echo "==================="
printf "\n\n"
echo "You can watch the logs \"docker-compose logs -f\" and \"open http://localhost:3000\""
